<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asian News Aggregator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .source-nbc { border-left-color: #0066cc; }
        .source-scmp { border-left-color: #ff6b00; }
        .source-nikkei { border-left-color: #e60012; }
        .pitch-modal {
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-inter">
    <!-- Header -->
    <header class="gradient-bg text-white py-8 px-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Asian News Aggregator</h1>
                    <p class="text-white/80 mt-2 text-sm md:text-base">Your curated feed of Asian-related news from trusted sources</p>
                </div>
                <button onclick="refreshArticles()" class="bg-white/20 hover:bg-white/30 backdrop-blur px-4 py-2 rounded-lg transition-all flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span class="hidden md:inline">Refresh</span>
                </button>
            </div>
            
            <!-- Source Filters -->
            <div class="flex flex-wrap gap-2 mt-6">
                <button onclick="filterBySource('all')" class="filter-btn active bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm transition-all" data-source="all">
                    All Sources
                </button>
                <button onclick="filterBySource('NBC Asian America')" class="filter-btn bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full text-sm transition-all" data-source="NBC Asian America">
                    NBC Asian America
                </button>
                <button onclick="filterBySource('South China Morning Post')" class="filter-btn bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full text-sm transition-all" data-source="South China Morning Post">
                    SCMP
                </button>
                <button onclick="filterBySource('Nikkei Asia')" class="filter-btn bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full text-sm transition-all" data-source="Nikkei Asia">
                    Nikkei Asia
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Loading State -->
        <div id="loading" class="flex flex-col items-center justify-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
            <p class="mt-4 text-gray-500">Fetching latest news...</p>
        </div>

        <!-- Articles Grid -->
        <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-20">
            <svg class="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
            </svg>
            <p class="mt-4 text-gray-500">No articles found. Try refreshing the feed.</p>
        </div>
    </main>

    <!-- Pitch Modal -->
    <div id="pitch-modal" class="fixed inset-0 bg-black/50 pitch-modal hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">ðŸ“± Social Media Pitch</h3>
                <button onclick="closePitchModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="pitch-content" class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 mb-4">
                <p id="pitch-text" class="text-gray-700 whitespace-pre-line"></p>
            </div>
            <div class="flex gap-3">
                <button onclick="copyPitch()" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-medium hover:opacity-90 transition-all flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    Copy to Clipboard
                </button>
                <button onclick="regeneratePitch()" class="px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl font-medium transition-all">
                    ðŸ”„
                </button>
            </div>
        </div>
    </div>

    <script>
        let allArticles = [];
        let currentFilter = 'all';
        let currentPitchArticle = null;

        function getSourceClass(source) {
            if (source.includes('NBC')) return 'source-nbc';
            if (source.includes('SCMP') || source.includes('Morning Post')) return 'source-scmp';
            if (source.includes('Nikkei')) return 'source-nikkei';
            return '';
        }

        function getSourceColor(source) {
            if (source.includes('NBC')) return 'bg-blue-100 text-blue-700';
            if (source.includes('SCMP') || source.includes('Morning Post')) return 'bg-orange-100 text-orange-700';
            if (source.includes('Nikkei')) return 'bg-red-100 text-red-700';
            return 'bg-gray-100 text-gray-700';
        }

        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        function createArticleCard(article) {
            const cleanSummary = stripHtml(article.summary);
            return `
                <article class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden card-hover transition-all duration-300 flex flex-col border-l-4 ${getSourceClass(article.source)}">
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${getSourceColor(article.source)}">
                                ${article.source}
                            </span>
                        </div>
                        <h2 class="text-lg font-semibold text-gray-800 mb-3 line-clamp-2 leading-snug">
                            ${article.title}
                        </h2>
                        <p class="text-gray-500 text-sm mb-4 line-clamp-3 flex-1">
                            ${cleanSummary || 'No summary available.'}
                        </p>
                        <div class="flex gap-2 mt-auto">
                            <a href="${article.link}" target="_blank" rel="noopener noreferrer" 
                               class="flex-1 text-center bg-gray-100 hover:bg-gray-200 text-gray-700 py-2.5 rounded-xl text-sm font-medium transition-all">
                                Read More â†’
                            </a>
                            <button onclick='openPitchModal(${JSON.stringify(article).replace(/'/g, "&#39;")})' 
                                    class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:opacity-90 text-white py-2.5 rounded-xl text-sm font-medium transition-all">
                                âœ¨ Social Pitch
                            </button>
                        </div>
                    </div>
                </article>
            `;
        }

        function renderArticles(articles) {
            const grid = document.getElementById('articles-grid');
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('empty-state');

            if (articles.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            grid.innerHTML = articles.map(createArticleCard).join('');
            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            loading.classList.add('hidden');
        }

        function filterBySource(source) {
            currentFilter = source;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-white/20');
                btn.classList.add('bg-white/10');
            });
            document.querySelector(`[data-source="${source}"]`).classList.remove('bg-white/10');
            document.querySelector(`[data-source="${source}"]`).classList.add('bg-white/20');

            if (source === 'all') {
                renderArticles(allArticles);
            } else {
                const filtered = allArticles.filter(a => a.source === source);
                renderArticles(filtered);
            }
        }

        async function fetchArticles() {
            const loading = document.getElementById('loading');
            const grid = document.getElementById('articles-grid');
            
            loading.classList.remove('hidden');
            grid.classList.add('hidden');

            try {
                const response = await fetch('/api/articles');
                allArticles = await response.json();
                filterBySource(currentFilter);
            } catch (error) {
                console.error('Error fetching articles:', error);
                document.getElementById('empty-state').classList.remove('hidden');
                loading.classList.add('hidden');
            }
        }

        function refreshArticles() {
            fetchArticles();
        }

        async function openPitchModal(article) {
            currentPitchArticle = article;
            const modal = document.getElementById('pitch-modal');
            const pitchText = document.getElementById('pitch-text');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            pitchText.textContent = 'Generating pitch...';

            try {
                const response = await fetch('/api/generate-pitch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: article.title,
                        summary: article.summary
                    })
                });
                const data = await response.json();
                pitchText.textContent = data.pitch;
            } catch (error) {
                pitchText.textContent = 'Error generating pitch. Please try again.';
            }
        }

        function closePitchModal() {
            const modal = document.getElementById('pitch-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        async function regeneratePitch() {
            if (currentPitchArticle) {
                const pitchText = document.getElementById('pitch-text');
                pitchText.textContent = 'Regenerating...';
                
                try {
                    const response = await fetch('/api/generate-pitch', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title: currentPitchArticle.title,
                            summary: currentPitchArticle.summary
                        })
                    });
                    const data = await response.json();
                    pitchText.textContent = data.pitch;
                } catch (error) {
                    pitchText.textContent = 'Error generating pitch.';
                }
            }
        }

        function copyPitch() {
            const pitchText = document.getElementById('pitch-text').textContent;
            navigator.clipboard.writeText(pitchText).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        document.getElementById('pitch-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePitchModal();
            }
        });

        fetchArticles();
    </script>
</body>
</html>
